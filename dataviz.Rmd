---
title: "rmarkdown dataviz example from healy text"
author: "MdM"
date: "March 4, 2019"
output: html_document
---


```{r setup, include=FALSE} 
knitr::opts_chunk$set(echo = TRUE)
# This is the standard .Rmd setup
```


```{r load_packages, include=FALSE, echo = FALSE }
#LOAD PACKAGES -- This will check if a package is installed and if not, install it
ipak <- function(pkg){
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if (length(new.pkg)) 
    install.packages(new.pkg, dependencies = TRUE, repos = "http://cran.us.r-project.org")
  sapply(pkg, require, character.only = TRUE)
}
#must set up the CRAN location url
packages <- c("foreign", "lessR", "rmarkdown", "tidyverse", "gt", "glue", "AER", "psych", "Hmisc", "ggplot2", "relaimpo", "socviz", "here")
#have to set the packages
ipak(packages)
```
### Packages used in this analysis
```{r, echo = FALSE}
packages
```
### Directory

##### Defaults to location of script file
```{r here}
here()
```


### Load the Gapminder data & lowercase variables
```{r load_data, echo=FALSE, warning=FALSE}
library(gapminder)
var.names<-tolower(colnames(gapminder))
colnames(gapminder)<-var.names
str(gapminder)
gapminder
```
\pagebreak

### Basic plot of Life Expectancy by GDP
>   two arguments here:  
          `data=` tells r where to find the data  
          `mapping = aes()` links *variables* to things you will *see in the plot*

```{r first_plot}
p <- ggplot(data=gapminder,
            mapping = aes(x=gdppercap, y=lifeexp))
p + geom_point()
```

\pagebreak

### Smoothed plot of Life Expectancy by Year
```{r plot}
p <- ggplot(data=gapminder,
            mapping = aes(x=year, y=lifeexp))
p + geom_smooth()
```

\pagebreak

### Smoothed plot of GDP by Life Expectancy
```{r}
p <- ggplot(data=gapminder,
            mapping = aes(x=gdppercap, y=lifeexp))
p + geom_smooth()
```

\pagebreak

### Smoothed plot of GDP by Life Expectancy
```{r}
p <- ggplot(data=gapminder,
            mapping = aes(x=gdppercap, y=lifeexp))
p + geom_smooth()
```

\pagebreak

### Smoothed plot of GDP by Life Expectancy with points
```{r}
p <- ggplot(data=gapminder,
            mapping = aes(x=gdppercap, y=lifeexp))
p + geom_point() + geom_smooth() 
```

\pagebreak

### Smoothed plot of Log transformed GDP by Life Expectancy with points
```{r}
p <- ggplot(data=gapminder,
            mapping = aes(x=gdppercap, y=lifeexp))
p + geom_point() + geom_smooth() + scale_x_log10()
```

\pagebreak

### Smoothed plot of Log transformed GDP by Life Expectancy with points scaled as dollars  
calls the `scales` package
```{r}
p <- ggplot(data=gapminder,
            mapping = aes(x=gdppercap, y=lifeexp))
p + geom_point() + geom_smooth(method="gam") + scale_x_log10(labels = scales::dollar)
```
\pagebreak

### A more polished plot
```{r polished}
p <- ggplot(data=gapminder, 
     mapping = aes(x=gdppercap, y=lifeexp))
          p + geom_point() + 
          geom_smooth(method="gam") + 
          scale_x_log10(labels = scales::dollar) +
          labs(x="GDP Per Capita", y = "Life Expectancy in Years",
               title = "Economic Growth and Life Expectancy",
               subtitle="Data points are country-years",
               caption = "Source: Gapminder")
```

\pagebreak

### Mapping aesthetics 

##### Specifies that a *variable* is expressed by a visual element (e.g., color, size, shape)
```{r}
p <- ggplot(data=gapminder, 
     mapping = aes(x=gdppercap, y=lifeexp,
     color = continent, fill = continent))
          p + geom_point() + 
          geom_smooth(method="loess") + 
          scale_x_log10(labels = scales::dollar) 
```

\pagebreak

### Aesthetics can be mapped by geom 

##### By default `geoms` inherit mappings from `ggplot()` function. You can change this by adding a `mapping` statement to the geom also
```{r}
p <- ggplot(data=gapminder, 
     mapping = aes(x=gdppercap, y=lifeexp))
          p + geom_point(mapping = aes(color=continent)) + 
          geom_smooth(method="loess") + 
          scale_x_log10(labels = scales::dollar) 
```
\pagebreak

### Can also map *continuous variable* to the color aesthetics

```{r}
p <- ggplot(data=gapminder, 
     mapping = aes(x=gdppercap, y=lifeexp))
          p + geom_point(mapping = aes(color=log(pop))) + 
          geom_smooth(method="loess") + 
          scale_x_log10(labels = scales::dollar) 
```

\pagebreak

### Set size of plot with options in the `chunk`

##### This one will make 12 inches wide by 9 inches high

```{r example, fig.width=12, fig.height=9}
p <- ggplot(data=gapminder, 
     mapping = aes(x=gdppercap, y=lifeexp))
          p + geom_point(mapping = aes(color=log(pop))) + 
          geom_smooth(method="loess") + 
          scale_x_log10(labels = scales::dollar) 
```
\pagebreak

### Save graph using `ggsave()`

##### This one will save plot as `p.out` in location set by `here` function
```{r savefile}
p <- ggplot(data=gapminder, 
     mapping = aes(x=gdppercap, y=lifeexp))

p.out <- p + geom_point(mapping = aes(color=continent)) + 
          geom_smooth(method="loess") + 
          scale_x_log10(labels = scales::dollar) 

ggsave(here("myfigure.tiff"), plot = p.out)
```

